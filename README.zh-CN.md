# NexusMF: 可插拔的微前端框架

**NexusMF** 是一个强大的、基于沙箱的微前端框架，其设计目标是无缝地连接和管理多个独立的 Web 应用。它为构建可扩展、高内聚、易于维护的大型项目提供了一套健壮的架构。"Nexus"（核心/枢纽）这个名字正反映了它的核心使命：作为一个中心枢纽，将多个应用编排成一个统一、连贯的用户体验。

本仓库包含了 NexusMF 的核心实现以及一个展示其能力的演示项目。

**[>> 在线演示 <<](https://wu9o.github.io/nexus-mf/)**

---

[English](./README.md) | **中文**

### 核心特性

- **可插拔的沙箱机制**: 框架设计支持多种沙箱解决方案（当前演示使用 Garfish），确保每个微应用都在完全隔离的环境中运行，以防止样式冲突和全局变量污染。
- **模块联邦 (Module Federation)**: 利用 Webpack 5 的模块联邦技术，在运行时动态加载微应用。
- **框架无关性**: 虽然本演示项目使用 React 构建，但其核心框架的设计旨在兼容任何 Web 技术。
- **Monorepo 架构**: 使用 `pnpm` workspaces 进行管理，提供了流畅的开发体验。
- **集中化配置**: 通过一个专门的 `@mf/shared-config` 包来管理共享配置，确保了项目的一致性和可维护性。
- **开发者友好**: 提供预设的 CI/CD 工作流以便于部署，并包含了处理单页应用（SPA）深层链接的清晰解决方案。

### 架构概览

NexusMF 的架构由一个 **主应用（基座/Nexus）** 和多个 **微应用** 组成。

```
+-------------------------------------------------+
|                      浏览器                     |
| +---------------------------------------------+ |
| |              主应用 (main-app)              | |
| | +-----------------------------------------+ | |
| | |         整体布局 (导航菜单, 顶栏)         | | |
| | +-----------------------------------------+ | |
| | |                                         | | |
| | |  +-----------------------------------+  | | |
| | |  |          微应用沙箱环境             |  | | |
| | |  |  (例如: Dashboard / Settings)     |  | | |
| | |  +-----------------------------------+  | | |
| | |                                         | | |
| | +-----------------------------------------+ | |
| +---------------------------------------------+ |
+-------------------------------------------------+
```

- **主应用 (`apps/main-app`)**:
  - 作为用户的入口和应用的容器。
  - 管理全局页面布局、导航菜单和核心的路由逻辑。
  - 根据当前 URL，负责将对应的微应用加载到一个沙箱环境中。

- **微应用 (`apps/dashboard`, `apps/settings`, etc.)**:
  - 是功能完整、可独立运行的 React 应用。
  - 通过模块联邦机制，将自身作为远程模块暴露出去。
  - 在主应用提供的沙箱内部运行，与其他微应用完全隔离。

### 关键实现细节

#### 1. 沙箱化的微前端加载器 (`SandboxMFE.js`)

这是本项目与其他微前端实现的核心区别。主应用中的 `SandboxMFE.js` 组件并非直接挂载远程组件，而是执行以下步骤：
1. 使用 `@garfish/browser-vm` 创建一个新的沙箱实例。
2. 在原生 `window` 环境中加载微应用的 `remoteEntry.js`，使其容器 (container) 成为全局可用。
3. 将远程容器以及像 React 这样的共享库注入到沙箱的全局作用域中。
4. 在沙箱内部执行微应用的启动代码，从而将整个微应用渲染在一个隔离的环境中。

#### 2. 依赖共享

为了优化性能并确保稳定性，关键的库在主应用和所有微应用之间共享。这在 `ModuleFederationPlugin` 的 `shared` 选项中进行配置。我们只显式地共享了那些必需的、需要单例的库：
- `react`
- `react-dom`
- `react-router-dom`
- `@arco-design/web-react`

#### 3. GitHub Pages 深层链接支持

GitHub Pages 是一个纯静态托管服务，原生不支持单页应用（SPA）的路由。为了解决直接访问深层链接（例如 `/mf/dashboard/details`）时出现 404 错误的问题，我们采用了一个简单而高效的技巧：
- GitHub Actions 的部署工作流 (`.github/workflows/deploy.yml`) 会将根目录的 `index.html` 复制一份并命名为 `404.html`。
- 当 GitHub Pages 遇到一个不存在的路径时，它会返回 `404.html` 文件，而这个文件实际上就是我们的主应用。
- React Router 启动后，会从地址栏获取当前路径，并正确地渲染对应的路由。

### 本地开发

1.  **克隆仓库:**
    ```bash
    git clone https://github.com/wu9o/nexus-mf.git
    cd nexus-mf
    ```

2.  **安装依赖:**
    ```bash
    pnpm install
    ```

3.  **并行启动所有应用:**
    此命令将同时启动主应用和所有微应用。
    ```bash
    pnpm --parallel --stream -r start
    ```

- 主应用: `http://localhost:3000`
- Dashboard 应用: `http://localhost:3001`
- User Management 应用: `http://localhost:3002`
- Settings 应用: `http://localhost:3003`
